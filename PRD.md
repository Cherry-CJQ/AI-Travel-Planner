
# 1. 产品需求文档 (PRD): AI 旅行规划助手

| 文档版本 | V1.0 |
| :--- | :--- |
| **创建日期** | 2025-10-25 |
| **创建人** | Jiaqi Chen |
| **项目代号** | "Voyager" |
| **状态** | [需求已确认] |

## 文档修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
| :--- | :--- | :--- | :--- |
| V1.0 | 2025-10-25 | Gemini | 初始版本创建，定义核心功能、技术栈建议和交付要求。 |

---

## 1. 引言

### 1.1. 项目背景
传统的旅行规划费时费力，用户需要在多个平台（地图、预订网站、点评网站）之间切换，手动整合信息。本项目旨在利用 AI 大语言模型 (LLM) 和语音识别技术，打造一个一站式的智能旅行规划 Web 应用。

### 1.2. 项目目标
* **简化规划：** 通过自然语言（语音/文字）输入，AI 自动生成完整的个性化旅行方案。
* **智能预算：** 提供基于 AI 的预算分析，并通过便捷的（语音）记账功能管理旅行开销。
* **数据便携：** 通过用户系统和云同步，实现旅行计划的多设备访问和管理。

### 1.3. 目标用户
* **P1: 效率型规划者** (例如：家庭出游的组织者、假期有限的白领)
    * **痛点：** 没有时间做详细攻略，但对旅行质量有一定要求（如用户示例中的“带孩子”、“喜欢美食和动漫”）。
    * **需求：** 希望快速获得一个靠谱、详细且个性化的行程单。
* **P2: 预算敏感型旅客** (例如：学生、背包客)
    * **痛点：** 需要严格控制开销，手动记账繁琐易忘。
    * **需求：** 在规划阶段就能了解大致预算，并在旅行中轻松记录花费。

---

## 2. 核心功能与用户故事

### 2.1. 用户故事 (User Stories)

* **(US-101) 快速规划:** 作为一个家长，我想要通过**语音**说出“下周末带 8 岁孩子去上海，3 天，喜欢科技馆和动物园，预算 5000”，以便快速得到一个适合家庭的详细日程表。
* **(US-102) 预算控制:** 作为一个旅行者，我想要 AI 帮我分析“去日本 5 天，1 万元预算”是否合理，并给出住宿、餐饮、交通的大致分配，以便我控制开销。
* **(US-103) 便捷记账:** 作为一个正在旅行的用户，我想要通过**语音**说“刚打车花了 30 块”，以便系统自动帮我记一笔账，而不需要我停下来打开 App 手动输入。
* **(US-104) 计划管理:** 作为一个喜欢规划的用户，我想要注册一个账户来保存我所有的旅行计划（比如“日本动漫之旅”、“毕业旅行”），以便我随时查看、修改和对比。

### 2.2. 功能需求 (Functional Requirements)

#### 2.2.1. 模块一：用户账户系统 (User Management)
* **FR-1.1 (注册):** 用户应能通过电子邮箱/密码进行注册。
* **FR-1.2 (登录/登出):** 用户应能使用已注册的凭证登录和安全登出。
* **FR-1.3 (认证):** 系统必须使用 JWT 或 Session-Cookie 机制维护用户登录状态。
* **FR-1.4 (数据持久化):** 用户的个人偏好、历史行程、费用记录必须与其账户关联，并存储在云端数据库（如 Supabase）。

#### 2.2.2. 模块二：智能行程规划 (Smart Itinerary Planning)
* **FR-2.1 (多模态输入):** 系统必须提供一个核心交互界面（如聊天框），支持两种输入方式：
    1.  **文字输入：** 用户可直接键入需求。
    2.  **语音输入 (P0 核心):**
        * 必须有一个清晰的“按住说话”或“点击录音”按钮。
        * 调用语音识别 API (如科大讯飞) 将语音实时或在结束后转换为文本。
        * 转换后的文本自动填充到输入框中。
* **FR-2.2 (自然语言理解):** 系统需能从用户的自然语言查询中提取关键意图和实体 (Entities)，至少包括：
    * `目的地` (e.g., "日本", "北京")
    * `时间` (e.g., "5 天", "下周末")
    * `预算` (e.g., "1 万元")
    * `同行人` (e.g., "带孩子", "和朋友")
    * `偏好` (e.g., "美食", "动漫", "博物馆", "轻松一点")
* **FR-2.3 (AI 行程生成):**
    * 系统将提取的实体和原始查询一起打包，发送给 LLM API。
    * **[关键]** Prompt 必须设计为引导 LLM 返回**结构化数据 (如 JSON)**，而不仅仅是文本段落。
    * 返回的 JSON 结构应至少包含：
        * `tripSummary`: { `title`: "日本 5 日动漫美食之旅", `estimatedTotalCost`: 9500 }
        * `budgetBreakdown`: { `flights`: 3000, `accommodation`: 2500, ... }
        * `dailyPlan`: [
            * { `day`: 1, `theme`: "抵达与探索", `activities`: [
                * { `time`: "14:00", `name`: "抵达东京成田机场", `description`: "...", `location`: { `lat`, `lng` }, `type`: "TRANSPORT" },
                * { `time`: "16:00", `name`: "酒店 Check-in (推荐: 新宿区)", `description`: "...", `location`: { ... }, `type`: "ACCOMMODATION" },
                * { `time`: "18:00", `name`: "晚餐: 一兰拉面", `description`: "...", `location`: { ... }, `type`: "FOOD" }
            * ]},
            * { `day`: 2, `theme`: "动漫朝圣", ... }
        * ]
* **FR-2.4 (行程展示):**
    * 行程应以清晰的时间轴 (Timeline) 形式展示 (Day 1, Day 2...)。
    * UI 必须美观，并能展示 LLM 提供的（或基于地点自动抓取的）图片。
* **FR-2.5 (地图交互 - P0 核心):**
    * 必须有一个**地图为主的交互界面** (如高德地图 API)。
    * 行程中所有带 `location` 的活动（景点、餐厅、酒店）都必须在地图上标记为图钉 (Pin)。
    * 点击时间轴上的活动项，地图应自动缩放并高亮对应的图钉。
    * 点击地图上的图钉，应能反向高亮时间轴上的活动项，并显示详情卡片。

#### 2.2.3. 模块三：费用预算与管理 (Budget & Expense)
* **FR-3.1 (AI 预算分析):** 在 FR-2.3 生成行程时，LLM 必须同时提供一份预算分析报告（见 `budgetBreakdown` 结构）。
* **FR-3.2 (记账输入):** 用户可以为当前行程添加开销。
    * **手动记账：** 提供表单输入（金额、类别[餐饮/交通/门票/购物...]、备注）。
    * **语音记账 (P1 推荐):** 用户可通过语音（同 FR-2.1 机制）输入，如“打车花了 50 块”。系统需调用 LLM (或简单规则) 解析出 `amount: 50` 和 `category: '交通'`。
* **FR-3.3 (开销统计):** 系统需提供一个简单的仪表盘，显示“总预算 vs. 已花费”以及按类别的支出饼图。
* **FR-3.4 (数据同步):** 所有费用记录必须与特定行程关联，并云端同步（FR-1.4）。

#### 2.2.4. 模块四：行程管理与设置 (Itinerary Management & Settings)
* **FR-4.1 (行程保存):** 用户必须能将 AI 生成的行程保存到自己的账户下（FR-1.4）。
* **FR-4.2 (行程列表):** 用户应有一个 "我的行程" 页面，可以查看、加载、编辑或删除已保存的行程。
* **FR-4.3 (API Key 设置 - P0 关键):**
    * **[安全红线]** 绝对不允许在代码中硬编码任何 API Key。
    * 必须在应用中提供一个“设置”或“配置”页面。
    * 该页面应提供**输入框**，让用户（助教）可以**自行输入**他们自己的 API Key，例如：
        * LLM API Key (e.g., 阿里云百炼 Key)
        * 语音识别 API Key (e.g., 科大讯飞 Key)
        * 地图 API Key (e.g., 高德 Key)
    * 这些 Key 应保存在浏览器的 `localStorage` 或通过后端安全存储（如果实现后端）。

---

## 3. 非功能需求 (Non-Functional Requirements)

* **NF-1 (安全 - Security):**
    * **[P0]** 严格遵守 FR-4.3，所有 API Key 必须由用户提供，不得在 Git 仓库中出现。`.env.example` 或 `config.example.json` 文件是必须的。
    * 用户密码存储必须加盐哈希 (Salted Hash)。
* **NF-2 (性能 - Performance):**
    * 语音识别转录应在 2 秒内返回。
    * LLM 行程生成（从发送到接收）应在 15 秒内完成，并提供加载中 (Loading) 状态。
    * 地图加载和图钉渲染必须流畅。
* **NF-3 (兼容性 - Compatibility):**
    * 必须是一个 Web 应用。
    * 应在最新版的 Chrome, Firefox, Safari 和 Edge 浏览器上正常运行。
    * 界面应具备基本的响应式设计，保证在移动端浏览器上可用（尤其是查看行程和记账功能）。
* **NF-4 (可用性 - Usability):**
    * 语音输入应有清晰的视觉反馈（如波纹动画、“识别中...”提示）。
    * 所有 AI 生成的内容（行程、预算）都应该是可编辑的，用户拥有最终控制权。
    * 错误处理：当 API 调用失败（如 LLM 超时、Key 错误、语音识别失败）时，必须向用户显示清晰、友好的错误提示。

---

## 4. 技术栈建议 (Tech Stack Recommendations)

* **前端 (Frontend):** React (推荐, 便于地图和状态管理) 或 Vue。
* **UI 库:** Ant Design, Element Plus 或 Shadcn UI (提供美观组件)。
* **地图 (Maps):** 高德地图 API 或 百度地图 API。
* **语音识别 (Voice):** 科大讯飞 Web API。
* **后端/数据库/认证 (BaaS):**
    * **推荐:** **Supabase** (提供 PostgreSQL 数据库, 认证, 存储)。
    * **备选:** 自建后端 (e.g., Node.js + Express/FastAPI) + 数据库 (e.g., PostgreSQL/MySQL)。
* **AI 核心 (LLM):**
    * **推荐 (按助教要求):** **阿里云百炼平台** (使用助教的 Key)。
    * **备选:** OpenAI API, Google Gemini API, 或其他支持 Function Calling / JSON 模式的 LLM。
* **部署 (Deployment):** **Docker (必须)**。

---

## 5. 交付物要求 (Submission Requirements)

* **D-1 (文档):**
    * 提交一个 `PDF` 文件。
    * PDF 中必须包含：
        1.  可公开访问的 GitHub Repo 地址。
        2.  完整的 `README.md` 文档内容。
* **D-2 (代码库 - GitHub):**
    * 项目代码必须提交在 GitHub 仓库中。
    * 必须保留**详细、有意义的 Git 提交记录** (Commit History)。
    * **[关键]** 根目录必须包含 `README.md` 和 `.gitignore` (确保 `node_modules`, `.env`, `*.key` 等文件被忽略)。
* **D-3 (部署 - Docker):**
    * 必须提供可直接下载运行的 `docker image` 文件（例如：通过阿里云镜像仓库、Docker Hub 或其他方式）。
    * **[可选加分项]** 建议使用 GitHub Actions 自动构建 Docker 镜像并推送到镜像仓库。
* **D-4 (README.md 内容):**
    * `README.md` 必须清晰说明：
        1.  项目简介。
        2.  **如何运行 (How to Run):** 详细的步骤，包括如何拉取 Docker 镜像和 `docker run` 命令。
        3.  **如何配置 (Configuration):**
            * **[关键]** 明确说明如何设置 API Key（指向应用的“设置”页面或配置文件 `config.json` / `.env`）。
            * 必须提供配置文件的示例 (`config.example.json` 或 `.env.example`)。
        4.  **[关键 - Key 提供]** 如果你使用的 API (如 LLM) 不是阿里云百炼（助教有 Key），你**必须**在 `README.md` 中提供一个你自己的、**有效期至少 3 个月**的测试 Key，以便助教批改。
